<!doctype html>
<html lang="en">
<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>SmartJen Technical Assessment</title>
		<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
		<link rel="stylesheet" href="https://jqueryui.com/resources/demos/style.css">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
		<style>
		#sortable {
			list-style-type: none;
			margin: 0;
			padding: 0;
		}
		#sortable li {
			padding: 5px;
			margin: 1.5em;
			margin-left: 2.5em;
			min-height: 18px;
			position: relative;
			border: 0;
		}
		#sortable li:focus-within {
			border: 1px solid black;
		}
		#sortable li>div.ui-icon.ui-icon-arrowthick-2-n-s {
			position: absolute;
			display: block;
			top: calc(-1.5em + 5px);
			left: 0;
			cursor: move;
			margin: 0;
			background-color: yellow;
		}
		#sortable li>div.section-remove {
			position: absolute;
			display: block;
			top: calc(-1.5em + 5px);
			right: 0;
			cursor: pointer;
			background-color: red;
		}
		.input-textarea {
			resize: none;
			overflow: hidden;
			font-size: 3em;
			line-height: 1;
			width: 100%;
			border: 0;
		}
		.input-textarea.multi-line {
			font-size: 1em;
		}
		</style>
		<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		<script>
		function rearrangeSequence() {
			let order = 1;
			$("#sortable>li").each(function(key, value) {
				$(value).find("input[name=\"question_sequence[]\"]").val(order++);
			});
		}
		function reassignTrigger() {
			$(".section-remove").off('click');
			$(".section-remove").on('click', removeListItem);
			$(".sectionType").off('change');
			$(".sectionType").on('change', changeSectionType);
			$(".input-textarea").off("input");
			$(".input-textarea").on("input", resizeTextArea);
		}
		function removeListItem() {
			$(this).closest("li").remove();
			rearrangeSequence();
		}
		function changeSectionType() {
			let typeSelect = $(this);
			let sectionField = null;
			if(typeSelect.val() === "title") {
				sectionField = $("#titleTemplate").clone().show().removeAttr("id");
			} else if(typeSelect.val() === "text") {
				sectionField = $("#textTemplate").clone().show().removeAttr("id");
			} else {
				sectionField = $("<div>Invalid Type</div>");
			}
			typeSelect.closest("li").append(sectionField);
			typeSelect.hide();
			reassignTrigger();
		}
		function resizeTextArea() {
			let theTextArea = $(this);
			if(!theTextArea.hasClass("multi-line")) {
				theTextArea.val(theTextArea.val().replace(/\s/g, " "));
			}
			theTextArea.css("height", "5px");
			theTextArea.css("height", (this.scrollHeight-4)+"px");
		}
		$( function() {
			$("#sortable").sortable({
				update: rearrangeSequence
			});
			// $("#sortable").disableSelection();
			$(".section-remove").on('click', removeListItem);
			$("#addSection").on('click', function() {
				let biggestId = 0;
				$("#sortable>li").each(function(key, value) {
					let currId = parseInt($(value).attr("id"));
					if(currId > biggestId) {
						biggestId = currId;
					}
				});
				let newField = $("#newSectionTemplate").clone().attr("id", (biggestId + 1));
				newField.find("input[name=\"question_sequence[]\"]").val(biggestId+1);
				newField.show();
				$("#sortable").append(newField);
				reassignTrigger();
			});
		} );
		</script>
	</head>
	<body>
		<ul id="sortable">
			<li id="1">
				<div class="ui-icon ui-icon-arrowthick-2-n-s"></div>
				<div class="section-remove" title="Remove Question"><i class="fa fa-times"></i></div>
				<input type="hidden" name="question_sequence[]" value="1" />
				<div class="question_wrapper">
					<span class="question_category">
						[Whole Numbers] Addition and Subtraction of Whole Numbers
					</span>
					<span class="question_difficulty">(2 Marks, Normal)</span>
					Extra content of Question here!
					Question 1!
				</div>
			</li>
			<li id="2">
				<div class="ui-icon ui-icon-arrowthick-2-n-s"></div>
				<div class="section-remove" title="Remove Question"><i class="fa fa-times"></i></div>
				<input type="hidden" name="question_sequence[]" value="2" />
				<div class="question_wrapper">
					<span class="question_category">
						[Whole Numbers] Addition and Subtraction of Whole Numbers
					</span>
					<span class="question_difficulty">(2 Marks, Normal)</span>
					Extra content of Question here!
					Question 2!
				</div>
			</li>
			<li id="3">
				<div class="ui-icon ui-icon-arrowthick-2-n-s"></div>
				<div class="section-remove" title="Remove Question"><i class="fa fa-times"></i></div>
				<input type="hidden" name="question_sequence[]" value="3" />
				<div class="question_wrapper">
					<span class="question_category">
						[Whole Numbers] Addition and Subtraction of Whole Numbers
					</span>
					<span class="question_difficulty">(2 Marks, Normal)</span>
					Extra content of Question here!
					Question 3!
				</div>
			</li>
			<li id="4">
				<div class="ui-icon ui-icon-arrowthick-2-n-s"></div>
				<div class="section-remove" title="Remove Question"><i class="fa fa-times"></i></div>
				<input type="hidden" name="question_sequence[]" value="4" />
				<div class="question_wrapper">
					<span class="question_category">
						[Whole Numbers] Addition and Subtraction of Whole Numbers
					</span>
					<span class="question_difficulty">(2 Marks, Normal)</span>
					Extra content of Question here!
					Question 4!
				</div>
			</li>
			<li id="5">
				<div class="ui-icon ui-icon-arrowthick-2-n-s"></div>
				<div class="section-remove" title="Remove Question"><i class="fa fa-times"></i></div>
				<input type="hidden" name="question_sequence[]" value="5" />
				<div class="question_wrapper">
					<span class="question_category">
						[Whole Numbers] Addition and Subtraction of Whole Numbers
					</span>
					<span class="question_difficulty">(2 Marks, Normal)</span>
					Extra content of Question here!
					Question 5!
				</div>
			</li>
		</ul>
		<input type="button" id="addSection" value="Add Section" />
		<li style="display: none;" id="newSectionTemplate">
			<div class="ui-icon ui-icon-arrowthick-2-n-s"></div>
			<div class="section-remove" title="Remove Section"><i class="fa fa-times"></i></div>
			<input type="hidden" name="question_sequence[]" value="1" />
			<select class="sectionType">
				<option value="">Select Type for Section</option>
				<option value="title">Title</option>
				<option value="text">Text</option>
			</select>
		</li>
		<div id="titleTemplate" style="display: none;">
			<textarea class="input-textarea" placeholder="Add Title Text" rows="1" wrap="soft"></textarea>
		</div>
		<div id="textTemplate" style="display: none;">
			<textarea class="input-textarea multi-line" placeholder="Add Text" rows="1" wrap="soft"></textarea>
		</div>
	</body>
</html>